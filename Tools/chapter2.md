برای توضیح تفاوت **TF-IDF** در جستجوی متن در موتورهای جستجو مثل الستیک‌سرچ، بیایید ابتدا مفهوم آن را ساده کنیم و سپس با یک مثال کاربردی در الستیک‌سرچ نشان دهیم.

### TF-IDF چیست؟
**TF-IDF** (Term Frequency - Inverse Document Frequency) یک الگوریتم وزن‌دهی است که در جستجوی متنی برای ارزیابی اهمیت یک کلمه در یک سند (داکیومنت) نسبت به کل مجموعه اسناد (ایندکس) استفاده می‌شود. این الگوریتم دو بخش اصلی دارد:

1. **TF (Term Frequency)**: تعداد دفعاتی که یک کلمه در یک سند خاص ظاهر می‌شود، تقسیم بر تعداد کل کلمات در آن سند. این نشان‌دهنده اهمیت کلمه در آن سند است.
2. **IDF (Inverse Document Frequency)**: معیاری که نشان می‌دهد یک کلمه چقدر در کل مجموعه اسناد نادر یا رایج است. اگر کلمه‌ای در اسناد زیادی باشد (مثل "و" یا "از")، وزن کمتری می‌گیرد.

**فرمول کلی TF-IDF**:
```
TF-IDF = TF * IDF
```
- `TF = (تعداد تکرار کلمه در سند) / (تعداد کل کلمات در سند)`
- `IDF = log(تعداد کل اسناد / تعداد اسنادی که کلمه در آن‌ها ظاهر شده)`

### چرا TF-IDF مهم است؟
TF-IDF به موتور جستجو کمک می‌کند تا اسنادی را که واقعاً مرتبط با عبارت جستجو هستند، اولویت‌بندی کند. کلمات نادر که معنای خاص‌تری دارند (مثل "الستیک‌سرچ") وزن بیشتری می‌گیرند نسبت به کلمات رایج (مثل "این").

### مثال ساده در الستیک‌سرچ
فرض کنید یک ایندکس به نام `books` داریم که شامل سه سند است:

1. **سند 1**: "آموزش الستیک‌سرچ برای جستجوی سریع"
2. **سند 2**: "جستجوی متنی با الستیک‌سرچ"
3. **سند 3**: "آموزش سریع پایتون"

حالا فرض کنید کاربر عبارت **"الستیک‌سرچ"** را جستجو می‌کند.

#### مرحله 1: محاسبه TF
- **کلمه "الستیک‌سرچ"**:
  - در سند 1: 1 بار ظاهر شده، کل کلمات سند 5 تا → `TF = 1/5 = 0.2`
  - در سند 2: 1 بار ظاهر شده، کل کلمات سند 4 تا → `TF = 1/4 = 0.25`
  - در سند 3: 0 بار ظاهر شده → `TF = 0`

- **کلمه "جستجوی"** (اگر کاربر مثلاً "جستجوی الستیک‌سرچ" را سرچ کند):
  - در سند 1: 1 بار، `TF = 1/5 = 0.2`
  - در سند 2: 1 بار، `TF = 1/4 = 0.25`
  - در سند 3: 0 بار، `TF = 0`

#### مرحله 2: محاسبه IDF
- **کلمه "الستیک‌سرچ"**:
  - تعداد کل اسناد: 3
  - تعداد اسنادی که "الستیک‌سرچ" در آن‌ها ظاهر شده: 2 (سند 1 و 2)
  - `IDF = log(3/2) ≈ 0.176`
- **کلمه "جستجوی"**:
  - تعداد اسنادی که "جستجوی" در آن‌ها ظاهر شده: 2 (سند 1 و 2)
  - `IDF = log(3/2) ≈ 0.176`

#### مرحله 3: محاسبه TF-IDF
- برای **"الستیک‌سرچ"**:
  - سند 1: `TF-IDF = 0.2 * 0.176 = 0.0352`
  - سند 2: `TF-IDF = 0.25 * 0.176 = 0.044`
  - سند 3: `TF-IDF = 0 * 0.176 = 0`
- برای **"جستجوی"** (در صورت جستجوی ترکیبی):
  - سند 1: `TF-IDF = 0.2 * 0.176 = 0.0352`
  - سند 2: `TF-IDF = 0.25 * 0.176 = 0.044`
  - سند 3: `TF-IDF = 0`

#### مرحله 4: رتبه‌بندی در الستیک‌سرچ
الستیک‌سرچ امتیاز هر سند را با ترکیب TF-IDF کلمات جستجو محاسبه می‌کند. در اینجا:
- سند 2 امتیاز بالاتری دارد (چون TF بالاتری برای "الستیک‌سرچ" دارد).
- سند 1 در رتبه بعدی قرار می‌گیرد.
- سند 3 چون کلمه "الستیک‌سرچ" را ندارد، در نتایج ظاهر نمی‌شود یا امتیاز صفر می‌گیرد.

### اجرای کوئری در Dev Tools کیبانا
برای جستجوی عبارت "الستیک‌سرچ" در ایندکس `books`، می‌توانید این کوئری را در Dev Tools اجرا کنید:

```json
GET /books/_search
{
  "query": {
    "match": {
      "content": "الستیک‌سرچ"
    }
  }
}
```

#### خروجی نمونه:
```json
{
  "hits": {
    "total": { "value": 2 },
    "hits": [
      {
        "_id": "2",
        "_score": 0.287,  // امتیاز بالاتر به دلیل TF بالاتر
        "_source": { "content": "جستجوی متنی با الستیک‌سرچ" }
      },
      {
        "_id": "1",
        "_score": 0.231,
        "_source": { "content": "آموزش الستیک‌سرچ برای جستجوی سریع" }
      }
    ]
  }
}
```

### تفاوت کلیدی TF-IDF
- **TF**: باعث می‌شود کلماتی که در یک سند بیشتر تکرار شده‌اند، وزن بیشتری داشته باشند.
- **IDF**: کلمات نادر (مثل "الستیک‌سرچ") را مهم‌تر از کلمات رایج (مثل "آموزش") می‌کند.
- در مثال بالا، "الستیک‌سرچ" چون در کل اسناد نادرتر است، وزن بیشتری در رتبه‌بندی دارد و سند 2 به دلیل تراکم بالاتر این کلمه، رتبه بهتری می‌گیرد.

### نکته در الستیک‌سرچ
الستیک‌سرچ از مدل **BM25** (نسخه بهبودیافته TF-IDF) به‌صورت پیش‌فرض استفاده می‌کند. BM25 محدودیت‌های TF-IDF (مثل حساسیت به طول سند) را بهبود داده، اما مفهوم کلی مشابه است.

اگر سوال بیشتری دارید یا نیاز به مثال دیگری بود، بگویید!
