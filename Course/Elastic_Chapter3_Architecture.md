# آموزش دنیای الستیک - قسمت سوم قسمت های مختلف الستیک استک
ویژگی های منحصر به فرد و پردبازده ی استک الستیک چیزی نیست جز ویژگی های اجزای مختلف آن پس لازم است بریم سراغ شناخت یک به یک آنها .


<img width="100%"  alt="db446f7acc590b3a66f6821118f1ad158e3f322b" src="https://github.com/user-attachments/assets/7e4b7645-6cbc-499a-be5b-208efdb095f0" />

---
## اجزای اصلی Elastic Stack چیست؟

 ۱. بخش **Elasticsearch**

هسته‌ی اصلی. یک موتور جستجوی **مبتنی بر Lucene** که داده‌ها را به صورت **داکیومنت** ذخیره می‌کند و از **ایندکس معکوس** برای جستجوی سریع استفاده می‌کند.

 ۲. بخش **Logstash**

یک پردازشگر قدرتمند داده. داده‌ها را از منابع مختلف جمع می‌کند، فیلتر می‌کند و به Elasticsearch می‌فرستد.

 ۳. بخش **Kibana**

ابزار ویژوال‌سازی. با آن می‌توان داشبورد ساخت، لاگ‌ها را جستجو کرد، آمار تحلیل کرد و حتی با آن هشدار تنظیم کرد.

 ۴. بخش **Beats** 

ابزارهای سبک برای ارسال داده از منابع مختلف مثل سیستم‌عامل، اپلیکیشن و غیره.



## معماری Elastic Stack:
```
Beats (جمع‌آوری) → Logstash (پردازش) → Elasticsearch (ذخیره/تحلیل) → Kibana (نمایش)
```

> <img width="100%" alt="1_5mWqMkmUb1Q_46jMhJfrXw" src="https://github.com/user-attachments/assets/e875bd10-581f-4ee2-a433-3e54da210303" />

> <img width="100%" alt="Untitled-2" src="https://github.com/user-attachments/assets/5ba2c404-ddc5-4b9d-9280-389f579f2527" />




> لزوما همیشه داده ها به Logstash نمیروند بعد بروند به ElasticSearch ممکنه خیلی وقتا پیش بیاید و مستقیم از Beat به ElasticSearch بروند.



## 1. بیتس Beats

بخش Beats از این معماری یه مجموعه ابزار سبک‌وزنه که صرفا برای جمع‌آوری داده‌های **خاص** طراحی شده.

مثل یه تیم متخصص که هر کدوم برای یه کار خاصن:

- **فایل بیت Filebeat**: برای جمع‌آوری لاگ‌های فایل.
- **متریک بیت Metricbeat**: برای جمع‌آوری معیارهای سیستم (مثل CPU و RAM).
- **پکت بیت Packetbeat**: برای مانیتورینگ شبکه.

### چرا Beats ؟

چون Logstash می‌تونه داده‌ها رو صرفا جمع کنه ، و Beat هم میتونه اما Beats سبک‌تر و تخصصی‌ترن.
مثلاً Filebeat فقط روی جمع‌آوری لاگ‌های فایل تمرکز داره و منابع کمتری مصرف می‌کنه.
یعنی یه حالت خاص جمع آوری کننده ی تخصصی هستند.


## 2. لاگستش Logstash
این بخش از معماری الستیک در تولید لاگ (مشترک با بیتس) و جمع آوری و پردازش اولیه ی لاگ ها و داده ها کاربرد دارد.

### لاگ‌ها گنجینه‌ی اطلاعاتن. چرا مهمن؟

- **عیب‌یابی**: اگه یه برنامه خراب بشه، لاگ‌ها بهتون می‌گن کجا و چرا.
- **بهبود عملکرد**: می‌فهمید سیستم کجاها کند شده و چطور بهترش کنید.
- **امنیت**: لاگ‌ها نشون می‌دن کی سعی کرده هک کنه یا یه چیز مشکوک شده.
- **تصمیم‌گیری**: با تحلیل لاگ‌ها می‌فهمید کاربرها چیکار می‌کنن و چطور خدماتتون رو بهتر کنید.

#### مثال
اگه یه فروشگاه آنلاین دارید، لاگ‌ها می‌گن چند نفر سبد خریدشون رو ول کردن و نخریدن—این یعنی یه سرنخ برای بهتر کردن سایتتون.

لاگستش Logstash یه ابزاره توی استک Elasticه که کارش جمع‌آوری، پردازش و ارسال داده‌هاست.
>  خود لاگ های خام برای الستیک هم مشکل ساز هستند چون خیلی وقتا خیلی لاگ ها به دردمان نمیخورد ولی تولید میشود ... خیلی وقتا لاگ ها محتوا های شلوغی دارند و بعدا ذخیره و بازیابی آنها سخت خواهد بود.

قبل از Logstash و Beats ، برای جمع‌آوری لاگ‌ها باید خودتون اسکریپت می‌نوشتید.
این اسکریپت‌ها سخت نگه‌داری می‌شدن و هر بار که چیزی عوض می‌شد، باید کلی تغییرشون می‌دادید. Logstash این کار رو استاندارد و ساده کرد.
مثلاً اگه لاگ‌هاتون توی یه فایل متنیه، Logstash می‌تونه خط به خط بخوندشون و به فرمت JSON بفرسته.


**لاگستش مثل یه پستچی باهوشه که:**

**جمع‌آوری**: لاگ‌ها رو از فایل‌ها، سرورها یا هر جای دیگه می‌گیره.
    
**پردازش**: داده‌ها رو مرتب می‌کنه (مثلاً تاریخ و ساعت رو جدا می‌کنه).
    
**ارسال**: به Elasticsearch می‌فرسته تا ذخیره بشن.
    
---


> <img  width="100%" alt="logstash" src="https://github.com/user-attachments/assets/bc2d3d46-f10b-4234-82fd-a3ec2e666b9e" />




> - ابزار Logstash اومد که داده‌ها رو از هر منبعی بگیره، تمیزشون کنه و آماده‌ی استفاده توی Elasticsearch کنه.
> - مثلاً اگه لاگ‌هاتون توی یه فایل متنیه، Logstash می‌تونه خط به خط بخوندشون و به فرمت JSON بفرسته.


### عملکرد Logstash
فرض کن یه فایل لاگ داری که خط‌هاش این شکلی‌ان:
```log file
2025-07-20 15:54:32, user: ali, action: login, status: success
2025-07-20 15:55:10, user: sara, action: logout, status: success
```
می‌خوای این لاگ‌ها رو بفرستی به Elasticsearch برای تحلیل، اما باید مرتب و ساختارمند بشن.

###  چیکار می‌کنه؟

- ورودی (Input): Logstash اون فایل لاگ رو می‌خونه.
- پردازش (Filter): داده‌ها رو تجزیه می‌کنه و به فرمت JSON تبدیلشون می‌کنه. مثلاً تاریخ، کاربر، اکشن و وضعیت رو جدا می‌کنه.
- خروجی (Output): داده‌های مرتب‌شده رو به Elasticsearch می‌فرسته.

### یه نمونه تنظیمات 
فرض کن فایل تنظیمات Logstash این شکلی باشه:
**مثال Pipeline**:

``` Logstash Pipeline
input {  file {    path => "/var/log/myapp.log"  }}
filter {  grok {    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp}, user: %{WORD:user}, action: %{WORD:action}, status: %{WORD:status}" }  }}
output {  elasticsearch {    hosts => ["http://localhost:9200"]    index => "myapp-logs"  }}
```
### چیو به چی تبدیل می‌کنه؟
ورودی (فایل لاگ خام):
```
2025-07-20 15:54:32, user: ali, action: login, status: success
```

### خروجی (داده‌های JSON برای Elasticsearch):
```Json
{
  "timestamp": "2025-07-20 15:54:32",
  "user": "ali",
  "action": "login",
  "status": "success"
}
```
### چجوری کار می‌کنه؟

- لاگستش فایل لاگ رو خط به خط می‌خونه.
- با فیلتر grok، هر خط رو به بخش‌های معنی‌دار (مثل کاربر و اکشن) تجزیه می‌کنه.
- داده‌های مرتب‌شده رو به مقصد (مثل Elasticsearch) می‌فرسته تا بتونی باهاش گزارش بسازی یا تحلیل کنی.

### نتیجه

لاگستش داده‌های شلخته و خام رو می‌گیره، مرتب و ساختارمند می‌کنه، و برای استفاده بعدی (مثل ذخیره یا نمایش) به یه سیستم دیگه می‌فرسته. 

---

## 3.الستیک سرچ Elasticsearch

---

## 4.کیبانا Kibana

- یک ابزار متن‌باز (open-source) برای **تحلیل و نمایش داده‌ها** است که بخشی از **Elastic Stack** محسوب می‌شود.
- این ابزار به شما کمک می‌کند داده‌های ذخیره‌شده در **Elasticsearch** را به‌صورت گرافیکی (مثل نمودار، جدول، داشبورد) ببینید، تحلیل کنید و باهاشون کار کنید.
- یعنی بیشتر در اختیار و نظارت مدیران سیستم است تا درگیر مفاهیم سطح پایین نشوند و مانیتورینگ داده ها به نحو احسن و خوانا صورت بگیرد.


> زبان ساده: فکر کنید Elasticsearch یه انبار بزرگ داده‌هاست؛ Kibana پنجره‌ایه که بهتون اجازه می‌ده ببینید چی داخل انباره و چه داره اتفاق می‌افته.


وظایف کیبانا Kibana:

- **نمایش داده‌ها**: لاگ‌ها رو به شکل نمودار، جدول یا نقشه نشون می‌ده.
- **تحلیل ساده**: با چند کلیک می‌تونید داده‌ها رو بررسی کنید.
- **دسترسی برای همه**: حتی کسایی که فنی نیستن هم می‌تونن ازش استفاده کنن.

مثلاً می‌تونید یه داشبورد بسازید که نشون بده هر ساعت چند تا خطا داشتید—همه‌چیز با رنگ و شکل قشنگ!


## مثال ساده از عملکرد Kibana با لاگ‌ها

فرض کن یه سرور داری که لاگ‌های فعالیت کاربران (مثل ورود به سیستم یا کلیک‌ها) تو Elasticsearch ذخیره می‌شه.
هر لاگ شامل اطلاعاتی مثل **زمان**، **نوع فعالیت** (مثل login) و **کاربر** (مثل user123) است.

### کیبانا چیو از Elasticsearch می‌گیره؟
کیبانا (Kibana) داده‌های خام (مثل لاگ‌های JSON) رو از Elasticsearch می‌خونه. مثلاً یه لاگ می‌تونه این شکلی باشه:
```json
{
  "timestamp": "2025-07-20 13:00:00",
  "user": "user123",
  "action": "login",
  "status": "success"
}
```

### چیکارش می‌کنه؟
1. **جستجو**: تو Kibana می‌تونی سرچ کنی و فقط لاگ‌های مربوط به "login" رو ببینی.
2. **نمایش**: یه داشبورد درست می‌کنی که مثلاً یه نمودار میله‌ای نشون بده چند نفر تو هر ساعت وارد سیستم شدن.
3. **تحلیل**: می‌تونی ببینی آیا ورودهای ناموفق (failed login) تو یه بازه زمانی خاص زیاد شدن یا نه.

**مثال خروجی در Kibana**: یه نمودار میله‌ای که نشون می‌ده تو ساعت 13:00، تعداد 50 ورود موفق و 5 ورود ناموفق داشتی. اینطوری سریع می‌فهمی کجا مشکلی هست.


> <img width="623" height="433" alt="chart" src="https://github.com/user-attachments/assets/4e56cad6-9bd3-4c74-96ce-a9f5ca755de0" />

---

**نمایی از داشبورد کیبانا (SIEM Dashboard) **

> <img width="100%" alt="siemdashboard" src="https://github.com/user-attachments/assets/5c0526e4-b23d-41b8-b84c-b0b0e156bd3c" />


---
































